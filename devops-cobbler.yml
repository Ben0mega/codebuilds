# These are the steps used in a container-based build in VSTS.
steps:    
- task: Docker@0
  displayName: Cobbler
  inputs:
    action: 'Run an image'
    command: 'run'
    imageName: 'headmelted/cobbler:cross-arm64'
    ports: 8084
    volumes: |
      $(Build.BinariesDirectory):/root/output
    envVars: |
      COBBLER_GIT_ENDPOINT=https://github.com/Microsoft/vscode
    containerCommand: /bin/bash -c 'echo "Running npm install for [$npm_config_target_arch]"; npm install --unsafe-perm; echo "Compiling VS Code for [$npm_config_target_arch]"; yarn run gulp vscode-linux-$npm_config_target_arch-min;';
    workDir: /root
    detached: false

# Restore this when repo:self bindings are figured out, and prevent pulling COBBLER_GIT_ENDPOINT.
# volumes: |
# ...
# $(Build.SourcesDirectory):/root/code 
